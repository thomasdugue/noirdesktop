<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noir ‚Äî Dev Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@200;300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg:       #000;
      --bg1:      #0a0a0a;
      --bg2:      #111;
      --bg3:      #161616;
      --border:   #1e1e1e;
      --border2:  #2a2a2a;
      --text:     #ebebeb;
      --sub:      #aaa;
      --muted:    #666;
      --dim:      #3a3a3a;
      --white:    #fff;
      --green:    #3ecf6a;
      --amber:    #d4a44e;
      --red:      #e05858;
      --blue:     #5aacff;
      --font: 'Geist Mono', monospace;
    }

    html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--font); font-size: 14px; line-height: 1.5; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .app { display: grid; grid-template-rows: 54px 1fr; height: 100vh; overflow: hidden; }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px; border-bottom: 1px solid var(--border);
      background: var(--bg1);
    }
    .header-left { display: flex; align-items: center; gap: 14px; }
    .logo-mark svg { display: block; }
    .app-title { font-size: 11px; font-weight: 400; letter-spacing: 0.4em; color: var(--muted); text-transform: uppercase; }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .token-wrap { display: flex; align-items: center; gap: 8px; }
    .token-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--dim); transition: background 0.3s; flex-shrink: 0; }
    .token-dot.ok { background: var(--green); box-shadow: 0 0 8px rgba(62,207,106,0.35); }
    .token-input {
      background: var(--bg2); border: 1px solid var(--border2); border-radius: 5px;
      padding: 6px 11px; color: var(--sub); font-family: var(--font); font-size: 12px;
      width: 280px; outline: none; letter-spacing: 0.04em; transition: border-color 0.15s;
    }
    .token-input:focus { border-color: var(--muted); color: var(--text); }
    .token-input::placeholder { color: var(--dim); }
    .btn-sm {
      background: var(--bg2); border: 1px solid var(--border2); border-radius: 5px;
      padding: 6px 13px; color: var(--sub); font-family: var(--font); font-size: 12px;
      cursor: pointer; letter-spacing: 0.04em; transition: all 0.15s;
    }
    .btn-sm:hover { border-color: var(--muted); color: var(--text); }

    /* ‚îÄ‚îÄ Main grid ‚îÄ‚îÄ */
    main { display: grid; grid-template-columns: 1fr 400px; overflow: hidden; }

    /* ‚îÄ‚îÄ Issues panel ‚îÄ‚îÄ */
    .issues-panel { border-right: 1px solid var(--border); overflow-y: auto; padding: 22px 26px; }
    .panel-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 16px; padding-bottom: 14px; border-bottom: 1px solid var(--border);
    }
    .panel-title { font-size: 11px; font-weight: 500; letter-spacing: 0.35em; color: var(--sub); text-transform: uppercase; }
    .issue-count { font-size: 12px; color: var(--muted); }

    .filter-bar { display: flex; gap: 6px; margin-bottom: 18px; flex-wrap: wrap; }
    .filter-chip {
      font-size: 10px; letter-spacing: 0.12em; padding: 4px 10px; border-radius: 4px;
      background: var(--bg2); border: 1px solid var(--border2); color: var(--muted);
      cursor: pointer; text-transform: uppercase; transition: all 0.12s;
    }
    .filter-chip:hover { color: var(--sub); border-color: var(--muted); }
    .filter-chip.active { border-color: var(--white); color: var(--white); }
    .filter-chip.bug.active    { border-color: var(--red);   color: var(--red); }
    .filter-chip.ux.active     { border-color: var(--blue);  color: var(--blue); }
    .filter-chip.sprint.active { border-color: var(--green); color: var(--green); }

    .issues-list { display: flex; flex-direction: column; gap: 3px; }

    .issue-row {
      display: flex; align-items: flex-start; gap: 12px;
      padding: 12px 14px; border-radius: 6px; cursor: pointer;
      border: 1px solid transparent; transition: all 0.12s; user-select: none;
    }
    .issue-row:hover { background: var(--bg2); border-color: var(--border); }
    .issue-row.selected { background: var(--bg2); border-color: var(--border2); }
    .issue-row.selected .issue-checkbox { background: var(--white); border-color: var(--white); }
    .issue-row.selected .issue-checkbox::after { opacity: 1; }

    .issue-checkbox {
      width: 15px; height: 15px; border-radius: 3px; border: 1px solid var(--dim);
      background: transparent; flex-shrink: 0; margin-top: 2px; position: relative; transition: all 0.12s;
    }
    .issue-checkbox::after {
      content: ''; position: absolute; inset: 2.5px; border-radius: 1px;
      background: var(--bg); opacity: 0;
    }

    .issue-content { flex: 1; min-width: 0; }
    .issue-title { font-size: 13px; font-weight: 400; color: var(--text); line-height: 1.45; margin-bottom: 7px; }
    .issue-meta { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }

    .badge {
      font-size: 9.5px; letter-spacing: 0.08em; padding: 2px 7px; border-radius: 3px;
      text-transform: uppercase; font-weight: 400;
    }
    .badge.bug     { background: rgba(224,88,88,0.12);  color: #e07070; border: 1px solid rgba(224,88,88,0.25); }
    .badge.ux      { background: rgba(90,172,255,0.1);  color: #7dc0ff; border: 1px solid rgba(90,172,255,0.2); }
    .badge.feature { background: rgba(212,164,78,0.1);  color: #d4a44e; border: 1px solid rgba(212,164,78,0.2); }
    .badge.sprint  { background: rgba(62,207,106,0.08); color: #3ecf6a; border: 1px solid rgba(62,207,106,0.18); }
    .badge.high    { background: rgba(224,88,88,0.08);  color: #c05050; border: 1px solid rgba(224,88,88,0.15); }
    .badge.effort  { background: var(--bg3); color: var(--sub); border: 1px solid var(--border2); }

    .issue-number { font-size: 11px; color: var(--muted); flex-shrink: 0; margin-top: 2px; }

    .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
    .empty-state p { font-size: 13px; line-height: 2; }

    .loading { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 48px; color: var(--muted); font-size: 13px; }
    .spinner { width: 15px; height: 15px; border: 1.5px solid var(--border2); border-top-color: var(--muted); border-radius: 50%; animation: spin 0.75s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Actions panel ‚îÄ‚îÄ */
    .actions-panel { display: flex; flex-direction: column; overflow-y: auto; padding: 20px; gap: 10px; background: var(--bg); }

    .selection-bar {
      background: var(--bg2); border: 1px solid var(--border2); border-radius: 6px;
      padding: 11px 14px; display: flex; align-items: center; justify-content: space-between; min-height: 42px;
    }
    .selection-label { font-size: 11px; color: var(--sub); letter-spacing: 0.08em; }
    .selection-issues { font-size: 12px; color: var(--green); letter-spacing: 0.04em; font-weight: 500; }
    .btn-clear { background: none; border: none; color: var(--muted); cursor: pointer; font-family: var(--font); font-size: 13px; padding: 2px 4px; }
    .btn-clear:hover { color: var(--text); }

    /* ‚îÄ‚îÄ Action cards ‚îÄ‚îÄ */
    .action-card {
      background: var(--bg1); border: 1px solid var(--border);
      border-radius: 7px; padding: 16px; transition: border-color 0.15s;
    }
    .action-card:hover { border-color: var(--border2); }

    .action-header { display: flex; align-items: center; margin-bottom: 7px; }
    .action-icon { font-size: 15px; margin-right: 9px; }
    .action-name { font-size: 13px; font-weight: 500; color: var(--white); letter-spacing: 0.03em; }
    .action-desc { font-size: 12px; color: var(--sub); line-height: 1.55; margin-bottom: 12px; }

    .cmd-preview {
      background: var(--bg); border: 1px solid var(--border); border-radius: 5px;
      padding: 9px 12px; font-size: 11px; color: var(--sub); line-height: 1.55;
      margin-bottom: 10px; word-break: break-all; letter-spacing: 0.02em;
    }
    .cmd-preview .hl  { color: var(--text); }
    .cmd-preview .dim { color: var(--muted); }

    .action-btns { display: flex; gap: 7px; }

    .btn-copy {
      flex: 1; background: var(--bg2); border: 1px solid var(--border2);
      border-radius: 5px; padding: 8px; color: var(--sub); font-family: var(--font);
      font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer;
      transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 5px;
    }
    .btn-copy:hover { border-color: var(--muted); color: var(--text); }
    .btn-copy.copied { border-color: var(--green); color: var(--green); }
    .btn-copy:disabled { opacity: 0.35; cursor: default; pointer-events: none; }
    .btn-copy.debug { color: var(--blue); border-color: rgba(90,172,255,0.25); }
    .btn-copy.debug:hover { border-color: var(--blue); }

    .btn-run {
      background: var(--bg2); border: 1px solid var(--border2);
      border-radius: 5px; padding: 8px 16px; color: var(--text); font-family: var(--font);
      font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer;
      transition: all 0.15s; display: flex; align-items: center; gap: 7px; white-space: nowrap;
    }
    .btn-run:hover { border-color: var(--green); color: var(--green); }
    .btn-run.running { border-color: var(--amber); color: var(--amber); pointer-events: none; }
    .btn-run.done    { border-color: var(--green); color: var(--green); pointer-events: none; }
    .run-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }
    .btn-run.running .run-dot { animation: blink 1s ease-in-out infinite; }
    @keyframes blink { 0%,100% { opacity:1 } 50% { opacity:0.25 } }

    .run-status {
      margin-top: 9px; padding: 9px 12px; border-radius: 5px;
      font-size: 12px; color: var(--sub); background: var(--bg);
      border: 1px solid var(--border); display: none; line-height: 1.5;
    }
    .run-status a { color: var(--blue); text-decoration: none; }
    .run-status a:hover { text-decoration: underline; }

    .card-debug { border-color: rgba(90,172,255,0.12); }
    .card-debug:hover { border-color: rgba(90,172,255,0.25); }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    #toast {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(16px);
      background: var(--bg2); border: 1px solid var(--border2); border-radius: 6px;
      padding: 9px 18px; font-size: 12px; color: var(--text); pointer-events: none;
      opacity: 0; transition: all 0.2s; white-space: nowrap; z-index: 100;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
  </style>
</head>
<body>
<div class="app">

  <header>
    <div class="header-left">
      <div class="logo-mark">
        <svg width="30" height="23" viewBox="0 0 100 80" fill="none">
          <g fill="white" fill-rule="evenodd">
            <ellipse cx="12" cy="40" rx="8" ry="8"/>
            <rect x="24" y="18" width="14" height="44" rx="7"/>
            <rect x="43" y="4" width="14" height="72" rx="7"/>
            <rect x="62" y="18" width="14" height="44" rx="7"/>
            <ellipse cx="88" cy="40" rx="8" ry="8"/>
          </g>
        </svg>
      </div>
      <span class="app-title">Dev Dashboard</span>
    </div>
    <div class="header-right">
      <div class="token-wrap">
        <div class="token-dot" id="tokenStatus"></div>
        <input class="token-input" id="tokenInput" type="password"
          placeholder="GitHub PAT ‚Äî stock√© localement"
          autocomplete="off" spellcheck="false">
        <button class="btn-sm" onclick="saveToken()">Save</button>
        <button class="btn-sm" onclick="loadIssues()">‚Üª Refresh</button>
      </div>
    </div>
  </header>

  <main>

    <!-- Issues -->
    <div class="issues-panel">
      <div class="panel-header">
        <span class="panel-title">Issues ¬∑ noir-feedback</span>
        <span class="issue-count" id="issueCount">‚Äî</span>
      </div>
      <div class="filter-bar">
        <span class="filter-chip active" onclick="setFilter('all',this)">All</span>
        <span class="filter-chip bug"    onclick="setFilter('bug',this)">Bugs</span>
        <span class="filter-chip ux"     onclick="setFilter('ux',this)">UX</span>
        <span class="filter-chip sprint" onclick="setFilter('sprint',this)">‚ö° Sprint</span>
        <span class="filter-chip"        onclick="setFilter('high',this)">üî¥ High prio</span>
      </div>
      <div class="issues-list" id="issuesList">
        <div class="empty-state"><p>Entre ton GitHub PAT<br>et clique Save.</p></div>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions-panel">

      <div class="selection-bar">
        <span class="selection-label">Issues s√©lectionn√©es</span>
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="selection-issues" id="selectionDisplay">aucune</span>
          <button class="btn-clear" onclick="clearSelection()">‚úï</button>
        </div>
      </div>

      <!-- Feedback Agent -->
      <div class="action-card">
        <div class="action-header">
          <span class="action-icon">üîÑ</span>
          <span class="action-name">Feedback Agent</span>
        </div>
        <div class="action-desc">R√©cup√®re &amp; classifie les nouvelles issues avec Claude Haiku. Ajoute les labels, g√©n√®re le rapport.</div>
        <div class="cmd-preview"><span class="hl">node</span> scripts/feedback-agent.js</div>
        <div class="action-btns">
          <button class="btn-copy" onclick="copyCmd('agent')">‚éò Copier</button>
          <button class="btn-run" id="runAgentBtn" onclick="runAgent()">
            <span class="run-dot"></span> Lancer
          </button>
        </div>
        <div class="run-status" id="agentStatus"></div>
      </div>

      <!-- Synth√®se Sprint -->
      <div class="action-card">
        <div class="action-header">
          <span class="action-icon">üìä</span>
          <span class="action-name">Synth√®se Sprint</span>
        </div>
        <div class="action-desc">Analyse co√ªt / impact / risques des sprint candidates. G√©n√®re SPRINT.md.</div>
        <div class="cmd-preview"><span class="hl">node</span> scripts/sprint-planner.js</div>
        <div class="action-btns">
          <button class="btn-copy" onclick="copyCmd('synth')">‚éò Copier</button>
        </div>
      </div>

      <!-- Plan d√©taill√© -->
      <div class="action-card">
        <div class="action-header">
          <span class="action-icon">üéØ</span>
          <span class="action-name">Plan d'impl√©mentation</span>
        </div>
        <div class="action-desc">G√©n√®re un plan d√©taill√© (Sonnet) pour les issues coch√©es √† gauche.</div>
        <div class="cmd-preview" id="planPreview">
          <span class="dim">‚Üê S√©lectionne des issues d'abord</span>
        </div>
        <div class="action-btns">
          <button class="btn-copy" id="planBtn" onclick="copyCmd('plan')" disabled>‚éò Copier</button>
        </div>
      </div>

      <!-- Debug -->
      <div class="action-card card-debug">
        <div class="action-header">
          <span class="action-icon">üîß</span>
          <span class="action-name">Launch Debug</span>
        </div>
        <div class="action-desc">Lance Noir en mode d√©veloppement Tauri avec hot-reload.</div>
        <div class="cmd-preview">
          <span class="hl">npm run tauri dev</span>
          <br><span class="dim">  # dans noir-tauri/</span>
        </div>
        <div class="action-btns">
          <button class="btn-copy debug" onclick="copyCmd('debug')">‚éò Copier</button>
        </div>
      </div>

      <div style="flex:1"></div>
      <div style="font-size:10px;color:var(--muted);letter-spacing:0.15em;text-align:center;padding:10px 0;border-top:1px solid var(--border);">
        NOIR DEV DASHBOARD ¬∑ v0.1.0 beta
      </div>
    </div>
  </main>
</div>

<div id="toast"></div>

<script>
const REPO_OWNER    = 'thomasdugue'
const FEEDBACK_REPO = 'noir-feedback'
const MAIN_REPO     = 'noirdesktop'
const PROJECT_DIR   = '~/Documents/Thomas/noirdesktop/noir-tauri'
const ENV_CMD       = 'export $(cat scripts/.env.local | xargs)'
const WORKFLOW_FILE = 'feedback-agent.yml'

let allIssues    = []
let selected     = new Set()
let activeFilter = 'all'

// Token
function saveToken() {
  const val = document.getElementById('tokenInput').value.trim()
  if (!val) return
  localStorage.setItem('noir_gh_token', val)
  setDot(true)
  loadIssues()
  showToast('Token sauvegard√© ‚úì')
}
function getToken() { return localStorage.getItem('noir_gh_token') || '' }
function setDot(ok) {
  document.getElementById('tokenStatus').className = 'token-dot' + (ok ? ' ok' : '')
}

// GitHub API
function ghFetch(path, opts = {}) {
  return fetch(`https://api.github.com${path}`, {
    ...opts,
    headers: {
      'Authorization': `token ${getToken()}`,
      'Accept': 'application/vnd.github+json',
      'X-GitHub-Api-Version': '2022-11-28',
      ...(opts.headers || {})
    }
  })
}

// Load issues ‚Äî no label filter, fetch all open
async function loadIssues() {
  if (!getToken()) return
  document.getElementById('issuesList').innerHTML =
    `<div class="loading"><div class="spinner"></div> Chargement‚Ä¶</div>`
  try {
    const res = await ghFetch(
      `/repos/${REPO_OWNER}/${FEEDBACK_REPO}/issues?state=open&per_page=100`
    )
    if (!res.ok) throw new Error(`GitHub ${res.status}`)
    const data = await res.json()
    allIssues = data.filter(i => !i.pull_request)
    setDot(true)
    renderIssues()
    document.getElementById('issueCount').textContent = `${allIssues.length} issues`
  } catch (e) {
    setDot(false)
    document.getElementById('issuesList').innerHTML =
      `<div class="empty-state"><p>Erreur: ${e.message}<br>V√©rifie ton PAT GitHub.</p></div>`
  }
}

// Filter
function setFilter(filter, el) {
  activeFilter = filter
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'))
  el.classList.add('active')
  renderIssues()
}
function getFiltered() {
  if (activeFilter === 'all')    return allIssues
  if (activeFilter === 'bug')    return allIssues.filter(i => i.labels.some(l => l.name === 'category:bug'))
  if (activeFilter === 'ux')     return allIssues.filter(i => i.labels.some(l => l.name === 'category:ux'))
  if (activeFilter === 'sprint') return allIssues.filter(i => i.labels.some(l => l.name === 'sprint-candidate'))
  if (activeFilter === 'high')   return allIssues.filter(i => i.labels.some(l => l.name === 'priority:high'))
  return allIssues
}

// Render
function getLabel(issue, prefix) {
  return issue.labels.find(l => l.name.startsWith(prefix))?.name.replace(prefix,'') ?? null
}
function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')
}
function renderIssues() {
  const issues = getFiltered()
  const el = document.getElementById('issuesList')
  if (!issues.length) {
    el.innerHTML = `<div class="empty-state"><p>Aucune issue pour ce filtre.</p></div>`
    return
  }
  el.innerHTML = issues.map(issue => {
    const cat      = getLabel(issue, 'category:')
    const effort   = getLabel(issue, 'effort:')
    const prio     = getLabel(issue, 'priority:')
    const isSprint = issue.labels.some(l => l.name === 'sprint-candidate')
    const isSel    = selected.has(issue.number)
    const badges = [
      cat    ? `<span class="badge ${cat}">${cat}</span>` : '',
      prio === 'high' ? `<span class="badge high">üî¥ high</span>` : '',
      isSprint        ? `<span class="badge sprint">‚ö° sprint</span>` : '',
      effort  ? `<span class="badge effort">${effort}</span>` : '',
    ].filter(Boolean).join('')
    return `<div class="issue-row ${isSel?'selected':''}" onclick="toggleIssue(${issue.number},this)">
      <div class="issue-checkbox"></div>
      <div class="issue-content">
        <div class="issue-title">${escHtml(issue.title)}</div>
        <div class="issue-meta">${badges}</div>
      </div>
      <span class="issue-number">#${issue.number}</span>
    </div>`
  }).join('')
}

// Selection
function toggleIssue(n, el) {
  if (selected.has(n)) { selected.delete(n); el.classList.remove('selected') }
  else { selected.add(n); el.classList.add('selected') }
  updateSelectionUI()
}
function clearSelection() {
  selected.clear()
  document.querySelectorAll('.issue-row.selected').forEach(el => el.classList.remove('selected'))
  updateSelectionUI()
}
function updateSelectionUI() {
  const nums    = [...selected].sort((a,b)=>a-b)
  const display = document.getElementById('selectionDisplay')
  const preview = document.getElementById('planPreview')
  const planBtn = document.getElementById('planBtn')
  if (!nums.length) {
    display.textContent = 'aucune'
    preview.innerHTML = `<span class="dim">‚Üê S√©lectionne des issues d'abord</span>`
    planBtn.disabled = true
  } else {
    display.textContent = nums.map(n=>`#${n}`).join(', ')
    preview.innerHTML = `<span class="hl">node</span> scripts/sprint-planner.js <span class="hl">--plan</span> ${nums.join(',')}`
    planBtn.disabled = false
  }
}

// Run agent via GitHub Actions dispatch
async function runAgent() {
  if (!getToken()) { showToast('Entre ton PAT d\'abord'); return }
  const btn    = document.getElementById('runAgentBtn')
  const status = document.getElementById('agentStatus')
  btn.className = 'btn-run running'
  btn.innerHTML = '<span class="run-dot"></span> En cours‚Ä¶'
  status.style.display = 'block'
  status.textContent   = 'D√©clenchement du workflow‚Ä¶'
  try {
    const res = await ghFetch(
      `/repos/${REPO_OWNER}/${MAIN_REPO}/actions/workflows/${WORKFLOW_FILE}/dispatches`,
      { method: 'POST', body: JSON.stringify({ ref: 'main' }) }
    )
    if (res.status === 204) {
      await new Promise(r => setTimeout(r, 2500))
      const runsRes  = await ghFetch(`/repos/${REPO_OWNER}/${MAIN_REPO}/actions/workflows/${WORKFLOW_FILE}/runs?per_page=1`)
      const runsData = await runsRes.json()
      const runUrl   = runsData.workflow_runs?.[0]?.html_url
        || `https://github.com/${REPO_OWNER}/${MAIN_REPO}/actions`
      btn.className = 'btn-run done'
      btn.innerHTML = '<span class="run-dot"></span> Lanc√© ‚úì'
      status.innerHTML = `Workflow lanc√© ‚Äî <a href="${runUrl}" target="_blank">voir le run ‚Üí</a>`
      showToast('Agent d√©clench√© ‚úì')
    } else {
      const err = await res.json().catch(() => ({ message: `HTTP ${res.status}` }))
      throw new Error(err.message)
    }
  } catch (e) {
    btn.className = 'btn-run'
    btn.innerHTML = '<span class="run-dot"></span> Lancer'
    status.textContent = `Erreur: ${e.message}`
    showToast('Erreur ‚Äî voir console')
    console.error(e)
  }
}

// Copy commands
const CMDS = {
  agent: `cd ${PROJECT_DIR} && ${ENV_CMD} && node scripts/feedback-agent.js`,
  synth: `cd ${PROJECT_DIR} && ${ENV_CMD} && node scripts/sprint-planner.js`,
  debug: `cd ${PROJECT_DIR} && npm run tauri dev`,
  plan:  () => {
    const nums = [...selected].sort((a,b)=>a-b).join(',')
    return `cd ${PROJECT_DIR} && ${ENV_CMD} && node scripts/sprint-planner.js --plan ${nums}`
  },
}
async function copyCmd(key) {
  const cmd = typeof CMDS[key]==='function' ? CMDS[key]() : CMDS[key]
  if (!cmd) return
  try {
    await navigator.clipboard.writeText(cmd)
    const btn  = event.currentTarget
    const orig = btn.innerHTML
    btn.innerHTML = '‚úì Copi√©'
    btn.classList.add('copied')
    setTimeout(() => { btn.innerHTML = orig; btn.classList.remove('copied') }, 1800)
    showToast('Commande copi√©e ‚Üí colle dans ton terminal')
  } catch { showToast('Erreur clipboard') }
}

// Toast
let toastTimer
function showToast(msg) {
  const el = document.getElementById('toast')
  el.textContent = msg
  el.classList.add('show')
  clearTimeout(toastTimer)
  toastTimer = setTimeout(() => el.classList.remove('show'), 2600)
}

// Init
;(function() {
  const token = getToken()
  if (token) {
    document.getElementById('tokenInput').value = token
    setDot(true)
    loadIssues()
  }
})()
</script>
</body>
</html>
