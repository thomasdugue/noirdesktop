<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noir</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Zone de drag pour déplacer la fenêtre (barre de titre macOS) -->
  <div class="titlebar" data-tauri-drag-region></div>

  <!-- Conteneur principal -->
  <div class="app">
    <!-- Sidebar : navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Noir</h2>
        <button id="select-folder" class="btn-icon" title="Ajouter un dossier">+</button>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-view="home" data-tooltip="Accueil">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
          <span class="nav-item-label">Accueil</span>
        </button>
        <button class="nav-item" data-view="albums" data-tooltip="Albums">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>
          </svg>
          <span class="nav-item-label">Albums</span>
        </button>
        <button class="nav-item" data-view="artists" data-tooltip="Artistes">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span class="nav-item-label">Artistes</span>
        </button>
        <button class="nav-item" data-view="tracks" data-tooltip="Titres">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
          </svg>
          <span class="nav-item-label">Titres</span>
        </button>
      </nav>

      <!-- Section Playlists -->
      <div class="sidebar-playlists">
        <div class="playlists-header">
          <span class="playlists-title">Playlists</span>
          <button id="create-playlist-btn" class="btn-icon-small" title="Nouvelle playlist">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/>
            </svg>
          </button>
        </div>
        <div id="playlists-list" class="playlists-list">
          <!-- Les playlists seront ajoutées dynamiquement -->
        </div>
      </div>

      <!-- Module Indexation (en bas de la sidebar) -->
      <div id="indexation-module" class="indexation-module">
        <!-- Header (toujours visible, cliquable pour toggle) -->
        <div class="indexation-header" id="indexation-header">
          <span class="indexation-title">Indexation</span>

          <!-- Contenu replié: progress mini (visible pendant indexation) -->
          <div id="indexation-progress-mini" class="indexation-progress-mini hidden">
            <div class="progress-mini-bar">
              <div id="progress-mini-fill" class="progress-mini-fill"></div>
            </div>
          </div>

          <!-- Contenu replié: bouton refresh (visible quand inactif) -->
          <button id="refresh-indexation-collapsed" class="btn-refresh-collapsed" title="Relancer l'indexation">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
              <path d="M21 3v5h-5"/>
            </svg>
          </button>

          <!-- Flèche toggle -->
          <button class="btn-toggle-indexation" id="btn-toggle-indexation" title="Afficher/masquer les détails">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
        </div>

        <!-- Contenu déplié -->
        <div id="indexation-content" class="indexation-content hidden">
          <!-- État actif: progression détaillée -->
          <div id="indexation-active" class="indexation-active hidden">
            <div class="indexation-progress-bar">
              <div id="indexation-progress-fill" class="indexation-progress-fill"></div>
            </div>
            <div class="indexation-progress-info">
              <span id="indexation-percent" class="indexation-percent">0%</span>
              <span id="indexation-folder" class="indexation-folder"></span>
            </div>
          </div>

          <!-- État inactif: stats -->
          <div id="indexation-inactive" class="indexation-inactive">
            <div class="indexation-stats-grid">
              <div class="indexation-stat">
                <span id="stat-artists" class="stat-value">-</span>
                <span class="stat-label">Artistes</span>
              </div>
              <div class="indexation-stat">
                <span id="stat-albums" class="stat-value">-</span>
                <span class="stat-label">Albums</span>
              </div>
              <div class="indexation-stat">
                <span id="stat-mp3" class="stat-value">-</span>
                <span class="stat-label">MP3</span>
              </div>
              <div class="indexation-stat">
                <span id="stat-flac16" class="stat-value">-</span>
                <span class="stat-label">FLAC 16</span>
              </div>
              <div class="indexation-stat">
                <span id="stat-flac24" class="stat-value">-</span>
                <span class="stat-label">FLAC 24</span>
              </div>
            </div>
            <button id="add-content-btn" class="btn-add-content" title="Ajouter un dossier de musique">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14"/>
                <path d="M5 12h14"/>
              </svg>
              Ajouter du contenu
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Zone principale -->
    <main class="main-content">
      <!-- Barre de recherche en haut -->
      <div class="search-bar">
        <div class="search-bar-inner">
          <input type="text" id="search-input" class="search-input" placeholder="Rechercher..." autocomplete="off">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
          </svg>
          <!-- Panel de résultats de recherche -->
          <div id="search-results-panel" class="search-results-panel hidden">
            <div class="search-results-content"></div>
          </div>
        </div>
      </div>

      <!-- Message de bienvenue -->
      <div id="welcome" class="welcome">
        <h1>Noir</h1>
        <p>Lecteur audio minimaliste</p>
        <button id="open-folder-welcome" class="btn-primary">
          Choisir un dossier de musique
        </button>
      </div>

      <!-- Grille d'albums -->
      <div id="albums-view" class="albums-view hidden">
        <div id="albums-grid" class="albums-grid"></div>
      </div>
    </main>
  </div>

  <!-- Menu contextuel -->
  <div id="context-menu" class="context-menu hidden">
    <button class="context-menu-item" data-action="play">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
      <span>Lecture</span>
    </button>
    <button class="context-menu-item" data-action="add-to-queue">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 5H3"/><path d="M16 12H3"/><path d="M9 19H3"/><path d="m16 16-3 3 3 3"/><path d="M21 5v12a2 2 0 0 1-2 2h-6"/>
      </svg>
      <span>Ajouter à la file</span>
    </button>
    <button class="context-menu-item context-menu-has-submenu" data-action="add-to-playlist">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/>
      </svg>
      <span>Ajouter à une playlist</span>
      <svg class="submenu-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
    </button>
    <!-- Sous-menu des playlists (généré dynamiquement) -->
    <div id="playlist-submenu" class="context-submenu hidden">
      <div id="playlist-submenu-list"></div>
      <div class="context-menu-separator"></div>
      <button class="context-menu-item" data-action="create-new-playlist">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/>
        </svg>
        <span>Nouvelle playlist...</span>
      </button>
    </div>
    <div class="context-menu-separator"></div>
    <button class="context-menu-item" data-action="go-to-album">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>
      </svg>
      <span>Voir l'album</span>
    </button>
    <button class="context-menu-item" data-action="go-to-artist">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
      <span>Voir l'artiste</span>
    </button>
    <div class="context-menu-separator"></div>
    <button class="context-menu-item context-menu-item-danger" data-action="remove-from-library">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
      </svg>
      <span>Supprimer de la bibliothèque</span>
    </button>
  </div>

  <!-- Panel File d'attente (Queue) -->
  <aside id="queue-panel" class="queue-panel">
    <div class="queue-header">
      <h3>File d'attente</h3>
      <button id="close-queue" class="btn-close-queue" title="Fermer">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6L6 18"/><path d="M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <div class="queue-now-playing">
      <span class="queue-label">En cours</span>
      <div id="queue-current" class="queue-current"></div>
    </div>

    <div id="queue-next" class="queue-next hidden">
      <div class="queue-next-header">
        <span class="queue-label">À suivre</span>
        <button id="clear-queue" class="btn-clear-queue" title="Vider la liste de lecture" style="display: none;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
          </svg>
        </button>
      </div>
      <div id="queue-list" class="queue-list"></div>
    </div>

    <div id="queue-empty" class="queue-empty">
      <p>La file d'attente est vide</p>
      <p class="queue-hint">Cliquez sur l'icône de liste pour ajouter un morceau</p>
    </div>
  </aside>

  <!-- Lecteur (fixé en bas, pleine largeur) -->
  <div id="player" class="player hidden">
    <!-- Zone gauche : cover + infos piste -->
    <div class="player-left">
      <div id="cover-art" class="cover-art cover-art-clickable" title="Voir l'album">
        <div class="cover-placeholder">♪</div>
      </div>
      <div class="now-playing">
        <span id="track-name">-</span>
        <span class="track-meta">
          <span id="track-folder" class="track-folder">-</span>
          <span id="audio-specs" class="audio-specs">
            <span class="specs-source">
              <span class="specs-label">SRC</span>
              <span id="source-specs" class="specs-value">-</span>
            </span>
            <span class="specs-separator">→</span>
            <span class="specs-output">
              <span class="specs-label">OUT</span>
              <span id="output-specs" class="specs-value">-</span>
            </span>
          </span>
        </span>
      </div>
    </div>
    <!-- Zone centrale : contrôles (position fixe) -->
    <div class="player-controls">
      <button id="shuffle" class="btn-mode" title="Lecture aléatoire">⤮</button>
      <button id="prev" class="btn-control btn-small">⏮</button>
      <button id="play-pause" class="btn-control">▶</button>
      <button id="next" class="btn-control btn-small">⏭</button>
      <button id="repeat" class="btn-mode" title="Répéter">⟳</button>
      <button id="queue-btn" class="btn-mode" title="File d'attente">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
        </svg>
      </button>
    </div>
    <!-- Zone droite : progress + volume -->
    <div class="player-right">
      <div class="progress-container">
        <span id="current-time">0:00</span>
        <input type="range" id="progress" class="progress-bar" value="0" min="0" max="100">
        <span id="duration">0:00</span>
      </div>
      <div class="volume-container">
        <button id="volume-btn" class="btn-volume" title="Volume">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path id="volume-icon-path" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          </svg>
        </button>
        <input type="range" id="volume" class="volume-bar" value="100" min="0" max="100">
      </div>
    </div>
    <audio id="audio"></audio>
  </div>

  <!-- Modale création/renommage playlist -->
  <div id="playlist-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <h3 id="playlist-modal-title">Nouvelle playlist</h3>
      <input type="text" id="playlist-name-input" class="modal-input" placeholder="Nom de la playlist" autofocus>
      <div class="modal-buttons">
        <button id="playlist-modal-cancel" class="btn-modal-secondary">Annuler</button>
        <button id="playlist-modal-confirm" class="btn-modal-primary">Créer</button>
      </div>
    </div>
  </div>

  <!-- Modale de confirmation générique -->
  <div id="confirm-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <h3 id="confirm-modal-title">Confirmer</h3>
      <p id="confirm-modal-message">Êtes-vous sûr ?</p>
      <div class="modal-buttons">
        <button id="confirm-modal-cancel" class="btn-modal-secondary">Annuler</button>
        <button id="confirm-modal-confirm" class="btn-modal-primary btn-danger">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Toast de notification -->
  <div id="toast" class="toast"></div>

  <script src="renderer.js"></script>
</body>
</html>
